name: CI Pipeline

# Trigger the workflow on push events to the main branch
# and on pull request events targeting the main branch.
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    # Use the latest Ubuntu LTS runner for the job.
    runs-on: ubuntu-latest

    strategy:
      matrix:
        # Test against multiple Python versions to ensure broad compatibility.
        python-version: ["3.10", "3.11", "3.12", "3.13"]

    steps:
      # Step 1: Check out the repository code.
      # This action checks out your repository so your workflow can access it.
      - name: Checkout Code
        uses: actions/checkout@v4

      # Step 2: Set up Python environment.
      # Sets up the specified Python version for use in workflows.
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          # Use 'uv' as the package manager. It's faster and more efficient.
          cache: 'uv'

      # Step 3: Install dependencies using uv.
      # 'uv' is used for fast dependency management.
      - name: Install Dependencies with uv
        run: |
          python -m pip install --upgrade pip
          uv pip install -r requirements.txt
          # If you have development-specific dependencies, install them too.
          # uv pip install -r requirements-dev.txt

      # Step 4: Lint and format the code using Ruff.
      # Ruff is used for fast linting and formatting, enforcing code quality.
      - name: Lint and Format with Ruff
        run: |
          uv pip install ruff
          ruff check .
          ruff format --check .

      # Step 5: Run tests using Pytest.
      # Pytest is the standard for Python testing.
      - name: Run Tests with Pytest
        run: |
          uv pip install pytest
          pytest

      # Step 6: (Optional) Generate and upload code coverage report.
      # This step requires a 'codecov' or similar setup.
      # - name: Upload Coverage to Codecov
      #   uses: codecov/codecov-action@v4
      #   with:
      #     token: ${{ secrets.CODECOV_TOKEN }}
      #     fail_ci_if_error: true

      # Step 7: (Optional) Deploy the application.
      # This step is typically for successful builds on the main branch.
      # Example: Deploying a Streamlit app.
      # - name: Deploy to Streamlit Cloud
      #   if: github.ref == 'refs/heads/main' && github.event_name == 'push'
      #   uses: streamlit/streamlit-action@v1
      #   with:
      #     api-key: ${{ secrets.STREAMLIT_API_KEY }}
      #     app-file: 'app.py'
      #     python-version: '${{ matrix.python-version }}'
      #     working-directory: '.'
